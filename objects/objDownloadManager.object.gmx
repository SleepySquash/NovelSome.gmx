<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>-10000</depth>
  <persistent>-1</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>dlCount=0; drMode=0; xx=-70; xx2=0; alpha=1; cFile=0; cDl=-1; aFile=0;
crDFile=""; lsDFile=""; completed=0; requested=0; alpha2=0; lstDl=-1;
downloading=0; waiting=0; dlstatus=-1; _info=noone; dPressed=-1; rMD5=0;
fRequested=0;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="62">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if (dlstatus==0) {if ds_map_find_value(async_load, "id") == _info {status = ds_map_find_value(async_load, "status");
    if status &gt;= 0 &amp;&amp; status!=1 {infof = ds_map_find_value(async_load, "result"); waiting=0;
        file=file_text_open_read(infof); aFile=0; if (file!=-1) {while (!file_text_eof(file)) {
            str=file_text_read_string(file); if (str!="") {fName[aFile]=str; fLoaded[aFile]=0; aFile+=1;} file_text_readln(file);}
            file_text_close(file); dlstatus=1; exit;} else {dlstatus=3; exit;}}
    else if status!=1 {_info=http_get_file(dPath[cDl]+"_DOWNLOAD_INFO.nsdl",working_directory+"Temp\DL\list.nsdl");}}}
else if (dlstatus==1 &amp;&amp; downloading) {if (rMD5) {
        if ds_map_find_value(async_load, "id") == reqMD5[cFile-1] {status = ds_map_find_value(async_load, "status");
        if status &gt;= 0 &amp;&amp; status!=1 {crMD5[cFile-1] = ds_map_find_value(async_load, "result"); _sMD5=""; rMD5=0; waiting=1;
            file=file_text_open_read(crMD5[cFile-1]); if (file!=-1) {_sMD5=file_text_read_string(file); file_text_close(file);}
            if (_sMD5!=_rMD5) {reqFile[cFile-1]=http_get_file(dPath[cDl]+"\"+fName[cFile-1],working_directory+"Temp\DLNV\"+fName[cFile-1]); fRequested=1;}
                else {waiting=0;}}
        else if status!=1 {reqFile[cFile-1]=http_get_file(dPath[cDl]+"\"+fName[cFile-1],working_directory+"Temp\DLNV\"+fName[cFile-1]); rMD5=0; fRequested=1;}}} else {
    if (!fRequested) {exit;}
    if ds_map_find_value(async_load, "id") == reqFile[cFile-1] {status = ds_map_find_value(async_load, "status");
    if status &gt;= 0 &amp;&amp; status!=1 {crFile[cFile-1] = ds_map_find_value(async_load, "result"); fLoaded[cFile-1]=1; fRequested=0; waiting=0;}
    else if status!=1 {reqFile[cFile-1]=http_get_file(dPath[cDl]+"\"+fName[cFile-1],working_directory+"Temp\DLNV\"+fName[cFile-1]); fRequested=1;}}}}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>drType=downloading; if (global.inGame) {if (!global.gamePause) {drType=0;}}
if (!waiting) {if (lstDl!=cDl &amp;&amp; cDl&lt;dlCount) {cFile=0; aFile=0; lstDl=cDl; waiting=0; downloading=1; dlstatus=0; nsndat="";
    if (dPath[cDl]!="") {if (nFolder[cDl]!="") {folName=nFolder[cDl];} else {folName=dName[cDl];}
        if (!directory_exists(working_directory+"Temp\")) {directory_create(working_directory+"Temp\");}
        if (!directory_exists(working_directory+"Temp\DL\")) {directory_create(working_directory+"Temp\DL\");}
        if (!directory_exists(working_directory+"Temp\DLNV\")) {directory_create(working_directory+"Temp\DLNV\");}
        _info=http_get_file(dPath[cDl]+"_DOWNLOAD_INFO.nsdl",working_directory+"Temp\DL\list.nsdl"); waiting=1;} else {downloading=0; exit;} requested=1;}}
if (!downloading &amp;&amp; !waiting) {if (cDl&lt;dlCount &amp;&amp; dlCount!=0) {cDl+=1;}}
if (downloading) {if (!waiting) {if (dlstatus==1) {
    if (cFile&lt;aFile) {if (!dwType[cDl]) {rMD5=0; fRequested=1; reqFile[cFile]=http_get_file(dPath[cDl]+"\"+fName[cFile],working_directory+"Temp\DL\"+folName+"\"+fName[cFile]); waiting=1; cFile+=1;}
        else {if (file_exists(FS_current_directory()+"\Novels\"+folName+"\"+fName[cFile])) {_rMD5="";
            _buffer=buffer_load(FS_current_directory()+"\Novels\"+folName+"\"+fName[cFile]); _rMD5=string(buffer_md5(_buffer,0,buffer_get_size(_buffer))); buffer_delete(_buffer);
            reqFile[cFile]=noone; rMD5=1; reqMD5[cFile]=http_get_file(dPath[cDl]+"\"+fName[cFile]+".md5",working_directory+"Temp\DL\"+folName+"\"+fName[cFile]+".md5"); waiting=1; cFile+=1;}
            else {rMD5=0; fRequested=1; reqFile[cFile]=http_get_file(dPath[cDl]+"\"+fName[cFile],working_directory+"Temp\DL\"+folName+"\"+fName[cFile]); waiting=1; cFile+=1;}}}
        else {dlstatus=2;}} else if (dlstatus==2) {fRequested=0; if (instance_exists(objStore)) {if (objStore.etype==6) {if (objStore.novScanned) {
            if (!dwType[cDl]) {if (nFolder[cDl]==string(objStore.novType)+" "+objStore.fldName) {objStore.cDlPress=1;}}
            else {if (objStore.nexpaned!=-1) {if (nFolder[cDl]==novdat.FolderName[objStore.nexpaned]) {objStore.cDlPress=1;}}}}}}
            if (!FS_directory_exists(FS_current_directory()+"\Novels\"+folName+"\")) {ns_directory_create(FS_current_directory()+"\Novels\"+folName+"\");}
            for (i=0;i&lt;aFile;i+=1) {if (fLoaded[i]) {ofname=fName[i]; isfol=check_for_slash(ofname); copied=(ofname==isfol); ffol="";
                if (copied) {ns_file_copy(crFile[i],FS_current_directory()+"\Novels\"+folName+"\"+fName[i]); ns_file_delete(crFile[i]);} else {
                while (!copied) {isfol=check_for_slash(ofname); if (isfol==ofname) {
                    ns_file_copy(crFile[i],FS_current_directory()+"\Novels\"+folName+"\"+fName[i]); ns_file_delete(crFile[i]); copied=1;}
                else {ofname=string_copy(ofname,string_length(isfol)+2,string_length(ofname)-string_length(isfol)-1); ffol+=isfol+"\";
                    ns_directory_create(FS_current_directory()+"\Novels\"+folName+"\"+ffol);}}}}}
            _nsndat=FS_file_find_first(FS_current_directory()+"\Novels\"+folName+"\*.nsndat",0); FS_file_find_close();
            if (_nsndat!="") {_crTime=generate_time();
                if (!dwType[cDl]) {crTime=generate_time(); story_load_preview(FS_current_directory()+"\Novels\"+folName+"\"+_nsndat,global.novelCount); crTime=_crTime;
                novdat.chanPose[global.novelCount-1]=global.novelCount-1; novdat.sortPose[global.novelCount-1]=global.novelCount-1;
                ds_map_add(novdat.expid,novdat.novelID[global.novelCount-1],global.novelCount-1); novdat.updated[global.novelCount-1]=crTime;} else {
                    crTime=_crTime; story_load(FS_current_directory()+"\Novels\"+folName+"\"+_nsndat,nNID[cDl],0);
                    crTime=_crTime; novdat.updated[nNID[cDl]]=crTime;} crTime=_crTime;
                if (!dwType[cDl]) {notcen_add("N",dName[cDl]+" была установлена!");} else {notcen_add("I",dName[cDl]+" была обновлена!");}
                FS_ini_open(working_directory+"Data\ndb\"+nDBName[cDl]+".nsldb"); _time=crTime; FS_ini_write_real((global.uniqueNumber),"updated",_time);
                FS_ini_write_real((global.uniqueNumber),"changed",_time); if (!dwType[cDl]) {FS_ini_write_real((global.uniqueNumber),"date",_time);} FS_ini_close();
                if (!dwType[cDl]) {novdat.ATpose[global.novelCount-1]=_time; novdat.ACpose[global.novelCount-1]=_time; novdat.AUpose[global.novelCount-1]=_time;}
                    else {novdat.ACpose[nNID[cDl]]=_time; novdat.AUpose[nNID[cDl]]=_time; for (i=0;i&lt;ds_list_size(upddat.list);i+=1) {
                        if (ds_list_find_value(upddat.list,i)==novelID[cDl]) {ds_list_delete(upddat.list,i); ds_map_delete(upddat.lmap,novelID[cDl]); upddat.updcount-=1;
                            if (instance_exists(objStore)) {if (objStore.etype==3) {objStore.isReq=0;}} break;}} novel_refresh_sort(1);}}
                else {notcen_add("W","Ошибка с распаковкой "+dName[cDl]+". Обновите список самостоятельно.");
                    FS_ini_open(working_directory+"Data\ndb\"+nDBName[cDl]+".nsldb"); _time=generate_time(); FS_ini_write_real((global.uniqueNumber),"updated",_time);
                    FS_ini_write_real((global.uniqueNumber),"changed",_time); if (!dwType[cDl]) {FS_ini_write_real((global.uniqueNumber),"date",_time);} FS_ini_close();}
            dlstatus=-1; completed=0; requested=0; download=0; downloading=0; cDl+=1; if (cDl&gt;=dlCount) {drMode=0;} nsndat=""; cFile=0; aFile=0; waiting=0;}}}
if (drType) {if (!drMode) {if (xx&lt;70) {xx+=14*Time.deltatime;}}} else {if (xx&gt;-70) {xx-=14*Time.deltatime;}}
if (xx&gt;0) {draw_set_alpha(alpha*0.4); draw_circle_colour(view_xview+xx-70,view_hview/2,70,c_black,c_black,0); draw_set_alpha(alpha);
draw_circle_colour(view_xview+xx-70,view_hview/2,70,c_white,c_white,1); draw_text_set(Pacifica21,c_white,fa_left,fa_middle);
if (cursor_under_button(view_xview+xx-70,view_hview/2,140,140)) {
    draw_set_alpha(alpha*0.3); draw_circle_colour(view_xview+xx-70,view_hview/2,70,c_black,c_black,0); draw_set_alpha(alpha);
    if (mouse_check_button_pressed(mb_left)) {drMode=!drMode; mouse_clear(mb_left);}}
if (aFile!=0) {txt=string(floor(cFile/aFile*100))} else {txt="100";} draw_text_outline(view_xview+xx-70+6,view_hview/2,txt+"%");}
if (!drMode) {if (alpha2&gt;0) {alpha2-=0.125*Time.deltatime;} if (xx2&gt;0) {xx2-=50*Time.deltatime;}}
else {if (xx&gt;-70) {xx-=14*Time.deltatime;} if (xx2&lt;400) {xx2+=50*Time.deltatime;} if (alpha2&lt;1) {alpha2+=0.125*Time.deltatime;}}
if (xx2&gt;0) {draw_set_alpha(alpha*0.3); draw_rectangle_colour(0,view_hview/2-230,xx2,view_hview/2+230,c_black,c_black,c_black,c_black,0); draw_set_alpha(alpha2);
    if (mouse_check_button_pressed(mb_middle)) {dPressed=-1; drMode=0; mouse_clear(mb_middle);}
    dcpr=0; if (cursor_under_button(view_xview+xx2/2,view_hview/2,xx2,230*2)) {if (mouse_check_button_pressed(mb_right)) {dcpr=1;}
        if (mouse_check_button_pressed(mb_left)) {dcpr=1;}} else {
        if (mouse_check_button_pressed(mb_right)) {dPressed=-1; drMode=0; mouse_clear(mb_right);}
        if (mouse_check_button_pressed(mb_left)) {dPressed=-1; drMode=!drMode; mouse_clear(mb_left);}} draw_set_alpha(alpha*0.3);
    draw_rectangle_colour(0,view_hview/2-230,xx2,view_hview/2-230+string_height("A")+10,c_black,c_black,c_black,c_black,0); draw_set_alpha(alpha2);
    draw_text_set(Pacifica28,c_white,fa_center,fa_top); draw_text_outline(view_xview+400/2,view_hview/2-230+5,lang.loading);
    yyh=view_hview/2-230+5+string_height("A")+5+2; draw_text_set(Pacifica21,c_white,fa_left,fa_top); for (i=cDl;i&lt;dlCount;i+=1) {draw_set_alpha(alpha*0.3);
        if (i==cDl) {_height=string_height("A")*3;} else {_height=string_height("A");}
        draw_rectangle_colour(0,yyh-1,xx2,yyh+_height+1,c_black,c_black,c_black,c_black,0);
        draw_rectangle_colour(0,yyh-1,xx2,yyh+string_height("A")+1,c_gray,c_gray,c_gray,c_gray,0);
        if (aFile!=0) {sum=cFile/aFile;} else {sum=1;} draw_set_halign(fa_left);
        if (i==cDl) {draw_rectangle_colour(0,yyh-1,xx2*(sum),yyh+string_height("A")+1,c_lime,c_lime,c_lime,c_lime,0);} draw_set_alpha(alpha2);
        if (cursor_under_button(xx2/2,yyh+(_height)/2,xx2,(_height))) {
            if (mouse_check_button_pressed(mb_left)) {if (dPressed==i) {notcen_add("W","Загрузка "+dName[i]+" была отменена");
                if (instance_exists(objStore)) {if (objStore.etype==6) {if (objStore.novScanned) {if (dwType[cDl]) {if (objStore.nexpaned!=-1) {
                    if (nFolder[cDl]==novdat.FolderName[objStore.nexpaned]) {objStore.cDlPress=1;}}} else {
                    if (nFolder[cDl]==string(objStore.novType)+" "+objStore.rName) {objStore.cDlPress=1;}}}}}
                if (folName!="") {_nsndat=file_find_first(working_directory+"Novels\"+folName+"\*.nsndat",0); file_find_close();
                    if (_nsndat!="") {ini_open(working_directory+"Novels\"+folName+"\"+_nsndat); ini_write_real("NOVELDATA","deleted",1) ini_close();}}
                cFile=0; aFile=0; downloading=0; requested=0; completed=0; dlstatus=-1; cDl+=1;} if (cDl&gt;=dlCount) {drMode=0;} mouse_clear(mb_right);}
            if (mouse_check_button_pressed(mb_right)) {dPressed=i; dcpr=0; mouse_clear(mb_right);}
            draw_rectangle_colour(0,yyh-1,xx2,yyh+_height+1,c_white,c_white,c_white,c_white,1);}
        if (dPressed==i) {draw_text_outline_ext(view_xview+4,yyh,lang.click_here_to_cancel,c_red,c_black);} else {
            draw_text_outline(view_xview+4,yyh,string(i+1)+") "+string(dName[i]));} yyh+=string_height("A");
        if (i==cDl) {if (dlstatus==1) {draw_set_halign(fa_center); if (dwType[cDl]) {addstr="Обновляем";} else {addstr="Скачиваем";}
            draw_text_outline(view_xview+400/2,yyh,addstr+" файлы ("+string(cFile)+" из "+string(aFile)+")"); yyh+=string_height("A");
            txt="..."; if (cFile&lt;aFile) {txt=fName[cFile];} draw_text_outline(view_xview+400/2,yyh,txt); yyh+=string_height("A");}
        else if (dlstatus==3) {draw_set_halign(fa_center); draw_text_outline(view_xview+400/2,yyh,"Ошибка загрузки"); yyh+=string_height("A")*2;}
        else if (dlstatus==2) {draw_set_halign(fa_center); draw_text_outline(view_xview+400/2,yyh,"Установка"); yyh+=string_height("A")*2;}
        else if (dlstatus==0) {draw_set_halign(fa_center); draw_text_outline(view_xview+400/2,yyh,"Запрос"); yyh+=string_height("A")*2;}} yyh+=5;} if (dcpr) {dPressed=-1;}}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
